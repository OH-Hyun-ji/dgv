<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="UserBoardDAO">
<resultMap type="UserDetailVO" id="UserDetailVO">
	<result column="user_num" property="user_num" jdbcType="INTEGER"/>
	<result column="user_point" property="user_point" jdbcType="INTEGER"/>
	<result column="user_rank" property="user_rank" jdbcType="VARCHAR"/>
	<result column="user_img" property="user_img" jdbcType="VARCHAR" />
	<result column="user_agree" property="user_agree" jdbcType="VARCHAR"/>
</resultMap>
<resultMap type="UserVO" id="UserVO">
	<result column="user_num" property="user_num" jdbcType="INTEGER"/>
	<result column="user_id" property="user_id" jdbcType="VARCHAR"/>
	<result column="user_pw" property="user_pw" jdbcType="VARCHAR"/>
	<result column="user_name" property="user_name" jdbcType="VARCHAR"/>
	<result column="user_phone" property="user_phone" jdbcType="VARCHAR"/>
	<result column="user_email" property="user_email" jdbcType="VARCHAR"/>
	<result column="user_year" property="user_year" jdbcType="VARCHAR"/>
	<result column="user_term" property="user_term" jdbcType="VARCHAR"/>
	<result column="user_month" property="user_month" jdbcType="VARCHAR"/>
	<result column="user_day" property="user_day" jdbcType="VARCHAR"/>
	<collection property="detailVO" resultMap="UserDetailVO"></collection>
</resultMap>

	<select id="NoticeList" resultType="AdminNoticeVO">
		SELECT * FROM dgv_notice
	</select>
	
	<select id="UserQnaOneList" resultType="UserInquiryVO">
		SELECT * FROM dgv_qna_wait where dgv_inquiry_user = #{userID}
	</select>
	
	<insert id="InsertMyQna" parameterType="UserInquiryVO">
		INSERT INTO dgv_qna_wait (dgv_inquiry_code,dgv_inquiry_tag,dgv_inquiry_title,dgv_inquiry_text,dgv_inquiry_user,dgv_inquiry_date,dgv_inquiry_status)
		VALUES(DEFAULT,#{dgv_inquiry_tag},#{dgv_inquiry_title},#{dgv_inquiry_text},#{dgv_inquiry_user},current_date,DEFAULT)
	</insert>
	
	<update id="viewCount" parameterType="int">
		UPDATE dgv_notice SET notice_count = notice_count+1 WHERE notice_num =#{notice_num}
	</update>
	
	<select id="noticeView" resultType="AdminNoticeVO">
		SELECT * FROM dgv_notice WHERE notice_num =#{notice_num}
	</select>
	
	<select id="faqList" resultType="UserFAQVO" parameterType="int">
		SELECT * FROM dgv_faq WHERE faq_kind_num=#{faq_kind_num}
	</select>
	<select id="faqKindList" resultType="UserFAQKindVO">
		SELECT * FROM faq_kind WHERE faq_kind_num =#{faq_kind_num}
	</select>
	<update id="faqCount" parameterType="int">
		UPDATE dgv_faq SET faq_count = faq_count+1 WHERE faq_num=#{faq_num}
	</update>
	
	<select id="faqVoSelect" resultType="UserFAQVO">
		SELECT * FROM dgv_faq WHERE faq_num=#{faq_num}
	</select>
	
	<insert id="communityInsert" parameterType="UserCommunityVO">
		INSERT INTO dgv_community(community_code,community_title,community_kind,community_text,commuity_img,user_id,write_date,write_time)
		VALUES(DEFAULT,#{community_title},#{community_kind},#{community_text},#{commuity_img},#{user_id},current_date,current_time)
	</insert>
	
	<update id="communityCountView" parameterType="int">
		UPDATE dgv_community SET community_count = community_count+1 WHERE community_code=#{community_code}
	</update>
	
	<select id="communitySelect" resultType="UserCommunityVO">
		SELECT * FROM dgv_community
			<trim prefix="WHERE" prefixOverrides="AND|OP">
			<if test="searchType=='community_title' and keyword != null and keyword !=''">
				WHERE community_title like '%#{keyword}%')
			</if>
		</trim>
		
	</select>
	
	<select id="communityChoiceNum" resultType="UserCommunityVO">
		SELECT * FROM dgv_community WHERE community_code =#{community_code}
	</select>
	
	<select id="communityUserInfo" resultMap="UserVO">
		SELECT * FROM user_info ui FULL JOIN user_info_detail uid ON ui.user_num = uid.user_num WHERE ui.user_id=#{user_id}
	</select>
	
	<select id="getSearchList" resultType="UserCommunityVO">
		SELECT * FROM dgv_community 
		<trim prefix="WHERE" prefixOverrides="AND|OP">
			<if test="searchType=='community_title' and keyword != null and keyword !=''">
				WHERE community_title like '%#{keyword}%')
			</if>
			<if test="searchType=='community_text' and keyword != null and keyword != ''">
				AND community_text like CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='user_id' and keyword != null and keyword != ''">
				AND user_id like CONCAT('%',#{keyword},'%')
			</if>
		</trim>
		
	</select>
	
	<select id="getCommunityCnt" resultType="int">
		SELECT count(*) as listCnt FROM dgv_community
		
	</select>
	
	<select id="myPagingMovie" resultType="AdminMovieVO">
		<![CDATA[
			select*from(
					select *,(row_number() over()) as rn1 from (
								select *,(row_number() over()) as rn from movie_info)as foo where rn <= #{pageNum} * #{amount})
											 as fd where rn1 > (#{pageNum}-1) * #{amount}
		]]>
	</select>
	
	<select id="myPaging" resultType="AdminMovieVO">
		select * from(
				select * from movie_info order by movie_num desc) as foo limit #{skip} offset #{amount};
	</select>
	
	<select id="getTotal" resultType="int">
		SELECT COUNT(*) FROM movie_info
	</select>
	
	<insert id="CommentInsert" parameterType="UserCommentVO">
		INSERT INTO dgv_comment(comment_num,community_code,comment_title,comment_text,user_id,write_date,write_time)
		VALUES(DEFAULT,#{community_code},#{comment_title},#{comment_text},#{user_id},current_date,DEFAULT)
	</insert>
	<select id="commentSelect" resultType="UserCommentVO">
		SELECT * FROM dgv_comment WHERE community_code=#{community_code}
	</select>
	
	
</mapper>